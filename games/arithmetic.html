<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Math Game</title>
<meta name="description" content="A pure math game.">
<!--        <link rel="stylesheet" href="style.css">-->
<!--        <script src="script.js"></script>-->
<script>

// global handles
let output;
let input;
let question, answer;
let wrongTimes = 0;
let level = -1;
question = [];

function init() {
    output = document.getElementById("outputElement");
    input = document.getElementById("inputElement");
    smoothShow(output,"Press enter");
}

function generateQAPair() {

    if (wrongTimes == 0) level++;
    else level--;
    if (level<0) level = 0;
    wrongTimes = 0;

    const macro_level = Math.floor(level / 4);
    const micro_level = level % 5;
    if (level > 0) document.title = 'Level ' + level;

    if (micro_level == 0) {
        const a = rand((level+1)*6)+1;
        const b = rand((level+1)*6)+1;
        return [a + " &plus; " + b, (a+b)];
    } else if (micro_level == 1) {
        let a = rand((level+1)*6)+1;
        let b = rand(a)+1;
        return [a + " &minus; " + b, (a-b)];
    } else if (micro_level == 2) {
        const a = rand(12)+1+(macro_level*2);
        const b = rand(12)+1+(macro_level*2);
        return [a + " &times; " + b, (a*b)];
    } else if (micro_level == 3) {
        let a = rand(12)+1+(macro_level*2);
        let b = rand(Math.floor(a/2))+2;
        return [a + " &divide; " + b, Math.floor(a/b)];
    } else if (micro_level == 4) {
        let a = rand(200)+1;
        let b = rand(macro_level*20)+1;
        return [a + "&percnt; of " + b, Math.floor(a/100 * b)];
    }
}

function smoothShow(boxHandle,newText,oldOpacity = 100,velocity = -2) { // -1 is down, 1 is up

    var newOpacity = oldOpacity + velocity;
    if(newOpacity==0) {
//        alert("stopping");
        boxHandle.innerHTML = newText;
        velocity = -velocity;
    } else if ( (newOpacity>=100) && (velocity>0) ) {
        return;
    }
    boxHandle.style.opacity = newOpacity/100;
    window.setTimeout(function(){
        smoothShow(boxHandle,newText,newOpacity,velocity);
    },10); // milliseconds
//    console.log("hi there!"+newOpacity);
}

function rand(max) {
    return Math.floor(Math.random() * max);
}

// this function will capture backspaces
document.addEventListener("keydown", KeyCheck);  //or however you are calling your method
function KeyCheck(event)
{
   var KeyID = event.keyCode;
   console.log("keycode:",KeyID)
   switch(KeyID)
   {
      case 8:
      input.innerHTML = input.innerHTML.slice(0,-1);
      break;
//      case 46:
//      alert("delete");
//      break;
      case 189:
      input.innerHTML = '-' + input.innerHTML;
      break;
      case 13:
      checkAnswer();
      break;
      default:
		if((48 <= KeyID) && (KeyID <= 57 ) ) {
			input.innerHTML += KeyID-48;
		}// else input.innerHTML = "";
      break;
   }
}

function checkAnswer() {

    if (answer !== undefined) {
        var response = parseInt(input.innerHTML);
        input.innerHTML = '';
        if(answer!==response) {
            if (wrongTimes===undefined) wrongTimes=0;
            wrongTimes++;
            return;
        } // else go down new question
    }

    [question, answer ] = generateQAPair();

    output.innerHTML = question;
    weredTime = new Date(); // now
}
</script>

<style>
/*The style*/

body {
    background-color:#222;
    color:#ddd;
    padding-top:300px;
    font-size:50px;
}
div {
    display:block;
    width:60%;
    min-width:200px;
    height:100px;
    margin:auto;
}
</style>

</head>
<body onload="init()">
<div id="outputElement">Preparing...</div>
<div id="inputElement"></div>
</body>
</html>
